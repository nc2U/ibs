{% load mathfilters humanize %}
<div class="right" style="font-size: 12px;">출력일자 : {{ pub_date }}</div>

<h2 class="center" style="margin-top: 30px; text-decoration: underline double;"> 일 자 별 연 체 료 </h2>

<table>
  <thead>
  <tr style="background-color: #eee;" class="center">
    <td>{{ contract.unit_type.name }} 타입</td>
    <td colspan="2">{{ unit|default:"동호 미지정" }}</td>
    <td>미납금액</td>
    <td class="right">{{ unpaid_amount|floatformat:0|default:"-"|intcomma }}</td>
    <td>계약자 : {{ contract.contractor }}</td>
  </tr>
  <tr class="center" style="background-color: #f5f5f5;">
    <td>납부일자</td>
    <td>일수</td>
    <td>연체율</td>
    <td>연체료</td>
    <td>납부금액</td>
    <td>비고</td>
  </tr>
  </thead>
  <tbody>
  {% for fee in daily_fees %}
  <tr class="center">
    <td>{{ fee.date|date:"Y-m-d" }}</td>
    <td>{{ fee.days }}</td>
    <td>{{ fee.penalty_rate }}</td>
    <td class="right">{{ fee.cumulative_penalty|default:"-"|intcomma }}</td>
    <td class="right">{{ fee.total_payment|default:"-"|intcomma }}</td>
    <td></td>
  </tr>
  {% empty %}
  <tr class="center">
    <td colspan="6" style="padding: 20px; color: #999;">미납 내역이 없습니다.</td>
  </tr>
  {% endfor %}
  </tbody>
</table>

{% if unpaid_installments %}
<div style="margin-top: 20px; font-size: 11px; padding: 10px; background-color: #f9f9f9; border: 1px solid #ddd;">
  <strong>{{ pub_date }} 기준 미납 회차 상세:</strong>
  <ul style="margin: 10px 0; padding-left: 20px;">
  {% for inst in unpaid_installments %}
    <li style="margin-top: 5px;">{{ inst.order_name }} (기한: {{ inst.due_date|date:"Y-m-d" }}) - 미납금액: {{ inst.remaining_amount|default:"-"|intcomma }}원, 연체일수: {{ inst.late_days|intcomma }}일</li>
  {% endfor %}
  </ul>
</div>
{% endif %}